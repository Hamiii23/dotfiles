#!/usr/bin/env bash
WALLPAPER_DIR="$HOME/.config/hypr/Wallpapers"
CACHE_FILE="$HOME/.cache/current_wallpaper"

[ ! -d "$WALLPAPER_DIR" ] && {
    notify-send "Error" "Dir not found"
    exit 1
}

WALLPAPER_LIST=$(find "$WALLPAPER_DIR" -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" \) | sort)

[ -z "$WALLPAPER_LIST" ] && {
    notify-send "Error" "No wallpapers found"
    exit 1
}

SELECTED=$(echo "$WALLPAPER_LIST" | sed 's|.*/||;s|\.[^.]*$||' | rofi -dmenu -i -p "Select Wallpaper")

[ -z "$SELECTED" ] && exit 0

WALLPAPER_PATH=$(echo "$WALLPAPER_LIST" | grep "/$SELECTED\.")

[ -z "$WALLPAPER_PATH" ] && {
    notify-send "Error" "Not found"
    exit 1
}

# Save current wallpaper for persistence
echo "$WALLPAPER_PATH" >"$CACHE_FILE"

# Set wallpaper with swww
swww img "$WALLPAPER_PATH" --transition-type fade --transition-duration 2 --transition-fps 60

notify-send "Wallpaper Changed" "$SELECTED"
