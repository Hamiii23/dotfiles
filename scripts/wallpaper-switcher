#!/usr/bin/env bash
D="$HOME/.config/hypr/Wallpapers"
CACHE="$HOME/.cache/current_wallpaper"

[ ! -d "$D" ] && {
    notify-send "Error" "Dir not found"
    exit 1
}

W=$(find "$D" -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" \) | sort)

[ -z "$W" ] && {
    notify-send "Error" "No wallpapers found"
    exit 1
}

S=$(echo "$W" | sed 's|.*/||;s|\.[^.]*$||' | rofi -dmenu -i -p "Select Wallpaper")

[ -z "$S" ] && exit 0

P=$(echo "$W" | grep "/$S\.")

[ -z "$P" ] && {
    notify-send "Error" "Not found"
    exit 1
}

# Save current wallpaper for persistence
echo "$P" >"$CACHE"

# Set wallpaper with swww
swww img "$P" --transition-type fade --transition-duration 2 --transition-fps 60

notify-send "Wallpaper Changed" "$S"
